# План интеграционного тестирования ContentFilter 
**Цель**: проверить устойчивость системы к сбоям зависимостей (Redis, self-restart) и корректность взаимодействия компонентов.

---

## Тест-кейсы

### I1: Перезапуск Redis
- **Предусловие**: сервис запущен, Redis доступен.  
- **Шаги**:  
  1. Отправить сообщение в очередь.  
  2. Остановить Redis.  
  3. Подождать 10 сек.  
  4. Запустить Redis.  
  5. Получить вердикт для отправленного сообщения.  
- **Ожидаемый результат**:  
  - Сообщение обработано,  
  - В Redis — один валидный JSON,  
  - `/verdict/` возвращает корректный ответ.

### I2: Перезапуск content-filter
- **Предусловие**: сервис запущен, есть сообщение в обработке.  
- **Шаги**:  
  1. Отправить сообщение.  
  2. Выполнить `docker compose restart content-filter`.  
  3. Запросить `/health`, `/verdict/`.  
- **Ожидаемый результат**:  
  - `/health` → `200` в течение 10 сек,  
  - `/verdict/` → корректный ответ.

### I3: Остановка nn_worker (имитация падения)
- **Предусловие**: сервис запущен.  
- **Шаги**:  
  1. Убить процесс `nn_worker` внутри контейнера.  
  2. Отправить новое сообщение.  
  3. Перезапустить контейнер.  
- **Ожидаемый результат**:  
  - Сообщения, отправленные после падения — в очереди,  
  - После рестарта — обрабатываются.

### I4: Некорректный пароль Redis
- **Предусловие**: изменить `REDIS_PASSWORD` в `.env`.  
- **Шаги**:  
  1. Пересобрать и запустить.  
  2. Отправить сообщение.  
- **Ожидаемый результат**:  
  - `nn_worker` падает, но API остаётся жив (`/health` → `200`),  
  - `/check/` → `503`, а не `500`.

---

## Критерии принятия
- Все `I1–I3` — ✅ PASSED,  
- `I4` — ✅ или ⚠️ (graceful degradation допустимо).