# Отчёт: API Smoke Testing (ручное тестирование)  

## Что тестируем
Базовая работоспособность REST API мессенджера:
- регистрация и вход,
- управление чатами,
- отправка сообщений.

### Цель 
Убедиться, что основные сценарии проходят, и выявить критические проблемы *до* интеграции ContentFilter.

---

## Предусловия
- Запущен MySQL (`127.0.0.1:3306`, БД `messenger`, схема из `sql/messenger.sql`),
- Запущен бэкенд: `uvicorn app.main:app --port 8000`,
- Использован `curl` в терминале для отправки запросов.

---

## Тест-кейсы

| № | Действие | Команда / Запрос | Ответ / Наблюдение | Статус |
|---|----------|------------------|---------------------|--------|
| 1 | Регистрация пользователя | `POST /register`<br>`{"username":"testuser","password":"pass123"}` | `{"status":"ok"}` | ✅ |
| 2 | Вход | `POST /login`<br>`{"username":"testuser","password":"pass123"}` | `{"username":"testuser","user_id":1,"avatar_url":null}` | ✅ |
| 3 | Создание чата | `POST /chats/create`<br>`{"name":"Test Chat","is_group":true,"created_by":1,"participant_ids":[1]}` | `{"chat_id":1}` | ✅ |
| 4 | Отправка сообщения | `POST /messages/send`<br>`{"sender_id":1,"chat_id":1,"content":"<script>alert(1)</script>"}` | `{"status":"ok","message_id":1}`<br>→ в БД: `<script>...` сохранён как есть | ⚠️ |
| 5 | Пустое сообщение | `POST /messages/send`<br>`{"content":""}` | `{"status":"ok","message_id":2}` | ⚠️ |
| 6 | Несуществующий `sender_id` | `POST /messages/send`<br>`{"sender_id":999, ...}` | `500` + текст `foreign key constraint fails` | ❌ |
| 7 | Длинное сообщение (10 000 символов) | `POST /messages/send`<br>`{"content":"AAA..."}` | `{"status":"ok","message_id":4}`<br>`LENGTH(content) = 10000` | ✅ |

---

## Анализ

1. **Валидация недостаточна**:  
   - Пустые и XSS-сообщения проходят без проверки → риск безопасности.  
   - Нет контроля длины `username`, `chat_name`.

2. **Обработка ошибок**:  
   - Ошибки БД (FK violation) → `500`, хотя должны быть `400`.  
   - Это нарушает принцип «не раскрывать внутренности».

3. **Хранение данных**:  
   - Пароль в открытом виде (`password_hash = 'pass123'`).

---

## Вывод
Базовые функции работают, но есть риск безопасности и некорректной обработки ошибок.

**Рекомендовано**:  
- Добавить валидацию `content` (мин. длина, запрет HTML/JS),  
- Обернуть БД-ошибки в `HTTP 4xx`,  
- Зашифровать пароли.